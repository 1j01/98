"use strict";var ZenFS_DOM=(()=>{var b=Object.defineProperty;var U=Object.getOwnPropertyDescriptor;var W=Object.getOwnPropertyNames;var _=Object.prototype.hasOwnProperty;var c=(e,t)=>b(e,"name",{value:t,configurable:!0});var Y=(e,t)=>{for(var i in t)b(e,i,{get:t[i],enumerable:!0})},z=(e,t,i,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of W(t))!_.call(e,r)&&r!==i&&b(e,r,{get:()=>t[r],enumerable:!(n=U(t,r))||n.enumerable});return e};var G=e=>z(b({},"__esModule",{value:!0}),e);var j={};Y(j,{IndexedDB:()=>Q,IndexedDBStore:()=>g,IndexedDBTransaction:()=>N,WebAccess:()=>X,WebAccessFS:()=>h,WebStorage:()=>H,WebStorageStore:()=>T});var J=ZenFS,{Async:I,AsyncTransaction:ee,BigIntStats:te,BigIntStatsFs:ie,Dir:se,Dirent:ne,Errno:S,ErrnoError:l,Fetch:re,FetchFS:ae,File:oe,FileSystem:v,FileType:D,InMemory:F,InMemoryStore:ce,IndexFS:le,Inode:de,LockedFS:Ee,Mutex:Se,NoSyncFile:ue,Overlay:me,OverlayFS:fe,Port:ye,PortFS:Oe,PortFile:he,PreloadFile:M,ReadStream:pe,Readonly:Ne,SimpleAsyncStore:ge,SimpleTransaction:k,Stats:w,StatsCommon:Te,StatsFs:be,StoreFS:R,Sync:Ie,SyncTransaction:De,Transaction:Fe,UnlockedOverlayFS:we,WriteStream:Re,ZenFsType:Ae,_toUnixTimestamp:Pe,access:xe,accessSync:ve,appendFile:Me,appendFileSync:ke,attachFS:Be,checkOptions:Ce,chmod:Le,chmodSync:He,chown:Ue,chownSync:We,close:_e,closeSync:Ye,configure:ze,constants:Ge,copyFile:Ke,copyFileSync:$e,cp:Ve,cpSync:Xe,createReadStream:qe,createWriteStream:Qe,decode:B,decodeDirListing:je,detachFS:Ze,encode:C,encodeDirListing:Je,errorMessages:et,exists:tt,existsSync:it,fchmod:st,fchmodSync:nt,fchown:rt,fchownSync:at,fdatasync:ot,fdatasyncSync:ct,flagToMode:lt,flagToNumber:dt,flagToString:Et,fs:St,fstat:ut,fstatSync:mt,fsync:ft,fsyncSync:yt,ftruncate:Ot,ftruncateSync:ht,futimes:pt,futimesSync:Nt,isAppendable:gt,isBackend:Tt,isBackendConfig:bt,isExclusive:It,isReadable:Dt,isSynchronous:Ft,isTruncating:wt,isWriteable:Rt,lchmod:At,lchmodSync:Pt,lchown:xt,lchownSync:vt,levenshtein:Mt,link:kt,linkSync:Bt,lopenSync:Ct,lstat:Lt,lstatSync:Ht,lutimes:Ut,lutimesSync:Wt,mkdir:_t,mkdirSync:Yt,mkdirpSync:zt,mkdtemp:Gt,mkdtempSync:Kt,mount:$t,mountObject:Vt,mounts:Xt,nop:qt,normalizeMode:Qt,normalizeOptions:jt,normalizePath:Zt,normalizeTime:Jt,open:ei,openAsBlob:ti,openSync:ii,opendir:si,opendirSync:ni,parseFlag:ri,promises:ai,randomIno:oi,read:ci,readFile:li,readFileSync:di,readSync:Ei,readdir:Si,readdirSync:ui,readlink:mi,readlinkSync:fi,readv:yi,readvSync:Oi,realpath:hi,realpathSync:pi,rename:Ni,renameSync:gi,resolveMountConfig:Ti,rm:bi,rmSync:Ii,rmdir:Di,rmdirSync:Fi,rootCred:wi,rootIno:Ri,setImmediate:Ai,size_max:Pi,stat:xi,statSync:vi,statfs:Mi,statfsSync:ki,symlink:Bi,symlinkSync:Ci,truncate:Li,truncateSync:Hi,umount:Ui,unlink:Wi,unlinkSync:_i,unwatchFile:Yi,utimes:zi,utimesSync:Gi,watch:Ki,watchFile:$i,write:Vi,writeFile:Xi,writeFileSync:qi,writeSync:Qi,writev:ji,writevSync:Zi}=ZenFS;function K(e,t){let i="",n=0,r=-1,a=0,d="\0";for(let o=0;o<=e.length;++o){if(o<e.length)d=e[o];else{if(d=="/")break;d="/"}if(d=="/"){if(!(r===o-1||a===1))if(a===2){if(i.length<2||n!==2||i.at(-1)!=="."||i.at(-2)!=="."){if(i.length>2){let f=i.lastIndexOf("/");f===-1?(i="",n=0):(i=i.slice(0,f),n=i.length-1-i.lastIndexOf("/")),r=o,a=0;continue}else if(i.length!==0){i="",n=0,r=o,a=0;continue}}t&&(i+=i.length>0?"/..":"..",n=2)}else i.length>0?i+="/"+e.slice(r+1,o):i=e.slice(r+1,o),n=o-r-1;r=o,a=0}else d==="."&&a!==-1?++a:a=-1}return i}c(K,"normalizeString");function $(e){if(!e.length)return".";let t=e.startsWith("/"),i=e.endsWith("/");return e=K(e,!t),e.length?(i&&(e+="/"),t?`/${e}`:e):t?"/":i?"./":"."}c($,"normalize");function A(...e){if(!e.length)return".";let t=e.join("/");return t?.length?$(t):"."}c(A,"join");function y(e){if(e.length===0)return".";let t=e[0]==="/",i=-1,n=!0;for(let r=e.length-1;r>=1;--r)if(e[r]==="/"){if(!n){i=r;break}}else n=!1;return i===-1?t?"/":".":t&&i===1?"//":e.slice(0,i)}c(y,"dirname");function O(e,t){let i=0,n=-1,r=!0;if(t!==void 0&&t.length>0&&t.length<=e.length){if(t===e)return"";let a=t.length-1,d=-1;for(let o=e.length-1;o>=0;--o)if(e[o]==="/"){if(!r){i=o+1;break}}else d===-1&&(r=!1,d=o+1),a>=0&&(e[o]===t[a]?--a===-1&&(n=o):(a=-1,n=d));return i===n?n=d:n===-1&&(n=e.length),e.slice(i,n)}for(let a=e.length-1;a>=0;--a)if(e[a]==="/"){if(!r){i=a+1;break}}else n===-1&&(r=!1,n=a+1);return n===-1?"":e.slice(i,n)}c(O,"basename");function V(e){switch(e.name){case"IndexSizeError":case"HierarchyRequestError":case"InvalidCharacterError":case"InvalidStateError":case"SyntaxError":case"NamespaceError":case"TypeMismatchError":case"ConstraintError":case"VersionError":case"URLMismatchError":case"InvalidNodeTypeError":return"EINVAL";case"WrongDocumentError":return"EXDEV";case"NoModificationAllowedError":case"InvalidModificationError":case"InvalidAccessError":case"SecurityError":case"NotAllowedError":return"EACCES";case"NotFoundError":return"ENOENT";case"NotSupportedError":return"ENOTSUP";case"InUseAttributeError":return"EBUSY";case"NetworkError":return"ENETDOWN";case"AbortError":return"EINTR";case"QuotaExceededError":return"ENOSPC";case"TimeoutError":return"ETIMEDOUT";case"ReadOnlyError":return"EROFS";case"DataCloneError":case"EncodingError":case"NotReadableError":case"DataError":case"TransactionInactiveError":case"OperationError":case"UnknownError":default:return"EIO"}}c(V,"errnoForDOMException");function u(e,t,i){if(e instanceof l)return e;let n=e instanceof DOMException?S[V(e)]:S.EIO,r=new l(n,e.message,t,i);return r.stack=e.stack,r.cause=e.cause,r}c(u,"convertException");var h=class extends I(v){_handles=new Map;_sync=F.create({name:"accessfs-cache"});constructor(t){super(),this._handles.set("/",t)}metadata(){return{...super.metadata(),name:"WebAccess",noResizableBuffers:!0}}async sync(t,i,n){let r=await this.stat(t);n.mtime!==r.mtime&&await this.writeFile(t,i)}async rename(t,i){try{let n=await this.getHandle(t);if(n instanceof FileSystemDirectoryHandle){let f=await this.readdir(t);if(await this.mkdir(i),f.length==0)await this.unlink(t);else for(let x of f)await this.rename(A(t,x),A(i,x)),await this.unlink(t)}if(!(n instanceof FileSystemFileHandle))return;let r=await n.getFile(),a=await this.getHandle(y(i));if(!(a instanceof FileSystemDirectoryHandle))return;let o=await(await a.getFileHandle(O(i),{create:!0})).createWritable();await o.write(await r.arrayBuffer()),o.close(),await this.unlink(t)}catch(n){throw u(n,t,"rename")}}async writeFile(t,i){if(i.buffer.resizable)throw new l(S.EINVAL,"Resizable buffers can not be written",t,"write");let n=await this.getHandle(y(t));if(!(n instanceof FileSystemDirectoryHandle))return;let a=await(await n.getFileHandle(O(t),{create:!0})).createWritable();await a.write(i),await a.close()}async createFile(t,i){return await this.writeFile(t,new Uint8Array),this.openFile(t,i)}async stat(t){let i=await this.getHandle(t);if(!i)throw l.With("ENOENT",t,"stat");if(i instanceof FileSystemDirectoryHandle)return new w({mode:511|D.DIRECTORY,size:4096});if(i instanceof FileSystemFileHandle){let{lastModified:n,size:r}=await i.getFile();return new w({mode:511|D.FILE,size:r,mtimeMs:n})}throw new l(S.EBADE,"Handle is not a directory or file",t,"stat")}async openFile(t,i){let n=await this.getHandle(t);if(!(n instanceof FileSystemFileHandle))throw l.With("EISDIR",t,"openFile");try{let r=await n.getFile(),a=new Uint8Array(await r.arrayBuffer()),d=new w({mode:511|D.FILE,size:r.size,mtimeMs:r.lastModified});return new M(this,t,i,d,a)}catch(r){throw u(r,t,"openFile")}}async unlink(t){let i=await this.getHandle(y(t));if(i instanceof FileSystemDirectoryHandle)try{await i.removeEntry(O(t),{recursive:!0})}catch(n){throw u(n,t,"unlink")}}async link(t){throw l.With("ENOSYS",t,"WebAccessFS.link")}async rmdir(t){return this.unlink(t)}async mkdir(t){if(await this.getHandle(t))throw l.With("EEXIST",t,"mkdir");let n=await this.getHandle(y(t));if(!(n instanceof FileSystemDirectoryHandle))throw l.With("ENOTDIR",t,"mkdir");await n.getDirectoryHandle(O(t),{create:!0})}async readdir(t){let i=await this.getHandle(t);if(!(i instanceof FileSystemDirectoryHandle))throw l.With("ENOTDIR",t,"readdir");let n=[];for await(let r of i.keys())n.push(r);return n}async getHandle(t){if(this._handles.has(t))return this._handles.get(t);let i="/";for(let n of t.split("/").slice(1)){let r=this._handles.get(i);if(!(r instanceof FileSystemDirectoryHandle))throw l.With("ENOTDIR",i,"getHandle");i=A(i,n);try{let a=await r.getDirectoryHandle(n);this._handles.set(i,a)}catch(a){let d=a;if(d.name=="TypeMismatchError")try{let o=await r.getFileHandle(n);this._handles.set(i,o)}catch(o){u(o,i,"getHandle")}if(d.name==="TypeError")throw new l(S.ENOENT,d.message,i,"getHandle");u(d,i,"getHandle")}}return this._handles.get(t)}};c(h,"WebAccessFS");var X={name:"WebAccess",options:{handle:{type:"object",required:!0,description:"The directory handle to use for the root"}},isAvailable(){return typeof FileSystemHandle=="function"},create(e){return new h(e.handle)}};var s;(function(e){e[e.EPERM=1]="EPERM",e[e.ENOENT=2]="ENOENT",e[e.EINTR=4]="EINTR",e[e.EIO=5]="EIO",e[e.ENXIO=6]="ENXIO",e[e.EBADF=9]="EBADF",e[e.EAGAIN=11]="EAGAIN",e[e.ENOMEM=12]="ENOMEM",e[e.EACCES=13]="EACCES",e[e.EFAULT=14]="EFAULT",e[e.ENOTBLK=15]="ENOTBLK",e[e.EBUSY=16]="EBUSY",e[e.EEXIST=17]="EEXIST",e[e.EXDEV=18]="EXDEV",e[e.ENODEV=19]="ENODEV",e[e.ENOTDIR=20]="ENOTDIR",e[e.EISDIR=21]="EISDIR",e[e.EINVAL=22]="EINVAL",e[e.ENFILE=23]="ENFILE",e[e.EMFILE=24]="EMFILE",e[e.ETXTBSY=26]="ETXTBSY",e[e.EFBIG=27]="EFBIG",e[e.ENOSPC=28]="ENOSPC",e[e.ESPIPE=29]="ESPIPE",e[e.EROFS=30]="EROFS",e[e.EMLINK=31]="EMLINK",e[e.EPIPE=32]="EPIPE",e[e.EDOM=33]="EDOM",e[e.ERANGE=34]="ERANGE",e[e.EDEADLK=35]="EDEADLK",e[e.ENAMETOOLONG=36]="ENAMETOOLONG",e[e.ENOLCK=37]="ENOLCK",e[e.ENOSYS=38]="ENOSYS",e[e.ENOTEMPTY=39]="ENOTEMPTY",e[e.ELOOP=40]="ELOOP",e[e.ENOMSG=42]="ENOMSG",e[e.EBADE=52]="EBADE",e[e.EBADR=53]="EBADR",e[e.EXFULL=54]="EXFULL",e[e.ENOANO=55]="ENOANO",e[e.EBADRQC=56]="EBADRQC",e[e.ENOSTR=60]="ENOSTR",e[e.ENODATA=61]="ENODATA",e[e.ETIME=62]="ETIME",e[e.ENOSR=63]="ENOSR",e[e.ENONET=64]="ENONET",e[e.EREMOTE=66]="EREMOTE",e[e.ENOLINK=67]="ENOLINK",e[e.ECOMM=70]="ECOMM",e[e.EPROTO=71]="EPROTO",e[e.EBADMSG=74]="EBADMSG",e[e.EOVERFLOW=75]="EOVERFLOW",e[e.EBADFD=77]="EBADFD",e[e.ESTRPIPE=86]="ESTRPIPE",e[e.ENOTSOCK=88]="ENOTSOCK",e[e.EDESTADDRREQ=89]="EDESTADDRREQ",e[e.EMSGSIZE=90]="EMSGSIZE",e[e.EPROTOTYPE=91]="EPROTOTYPE",e[e.ENOPROTOOPT=92]="ENOPROTOOPT",e[e.EPROTONOSUPPORT=93]="EPROTONOSUPPORT",e[e.ESOCKTNOSUPPORT=94]="ESOCKTNOSUPPORT",e[e.ENOTSUP=95]="ENOTSUP",e[e.ENETDOWN=100]="ENETDOWN",e[e.ENETUNREACH=101]="ENETUNREACH",e[e.ENETRESET=102]="ENETRESET",e[e.ETIMEDOUT=110]="ETIMEDOUT",e[e.ECONNREFUSED=111]="ECONNREFUSED",e[e.EHOSTDOWN=112]="EHOSTDOWN",e[e.EHOSTUNREACH=113]="EHOSTUNREACH",e[e.EALREADY=114]="EALREADY",e[e.EINPROGRESS=115]="EINPROGRESS",e[e.ESTALE=116]="ESTALE",e[e.EREMOTEIO=121]="EREMOTEIO",e[e.EDQUOT=122]="EDQUOT"})(s||(s={}));var L={[s.EPERM]:"Operation not permitted",[s.ENOENT]:"No such file or directory",[s.EINTR]:"Interrupted system call",[s.EIO]:"Input/output error",[s.ENXIO]:"No such device or address",[s.EBADF]:"Bad file descriptor",[s.EAGAIN]:"Resource temporarily unavailable",[s.ENOMEM]:"Cannot allocate memory",[s.EACCES]:"Permission denied",[s.EFAULT]:"Bad address",[s.ENOTBLK]:"Block device required",[s.EBUSY]:"Resource busy or locked",[s.EEXIST]:"File exists",[s.EXDEV]:"Invalid cross-device link",[s.ENODEV]:"No such device",[s.ENOTDIR]:"File is not a directory",[s.EISDIR]:"File is a directory",[s.EINVAL]:"Invalid argument",[s.ENFILE]:"Too many open files in system",[s.EMFILE]:"Too many open files",[s.ETXTBSY]:"Text file busy",[s.EFBIG]:"File is too big",[s.ENOSPC]:"No space left on disk",[s.ESPIPE]:"Illegal seek",[s.EROFS]:"Cannot modify a read-only file system",[s.EMLINK]:"Too many links",[s.EPIPE]:"Broken pipe",[s.EDOM]:"Numerical argument out of domain",[s.ERANGE]:"Numerical result out of range",[s.EDEADLK]:"Resource deadlock would occur",[s.ENAMETOOLONG]:"File name too long",[s.ENOLCK]:"No locks available",[s.ENOSYS]:"Function not implemented",[s.ENOTEMPTY]:"Directory is not empty",[s.ELOOP]:"Too many levels of symbolic links",[s.ENOMSG]:"No message of desired type",[s.EBADE]:"Invalid exchange",[s.EBADR]:"Invalid request descriptor",[s.EXFULL]:"Exchange full",[s.ENOANO]:"No anode",[s.EBADRQC]:"Invalid request code",[s.ENOSTR]:"Device not a stream",[s.ENODATA]:"No data available",[s.ETIME]:"Timer expired",[s.ENOSR]:"Out of streams resources",[s.ENONET]:"Machine is not on the network",[s.EREMOTE]:"Object is remote",[s.ENOLINK]:"Link has been severed",[s.ECOMM]:"Communication error on send",[s.EPROTO]:"Protocol error",[s.EBADMSG]:"Bad message",[s.EOVERFLOW]:"Value too large for defined data type",[s.EBADFD]:"File descriptor in bad state",[s.ESTRPIPE]:"Streams pipe error",[s.ENOTSOCK]:"Socket operation on non-socket",[s.EDESTADDRREQ]:"Destination address required",[s.EMSGSIZE]:"Message too long",[s.EPROTOTYPE]:"Protocol wrong type for socket",[s.ENOPROTOOPT]:"Protocol not available",[s.EPROTONOSUPPORT]:"Protocol not supported",[s.ESOCKTNOSUPPORT]:"Socket type not supported",[s.ENOTSUP]:"Operation is not supported",[s.ENETDOWN]:"Network is down",[s.ENETUNREACH]:"Network is unreachable",[s.ENETRESET]:"Network dropped connection on reset",[s.ETIMEDOUT]:"Connection timed out",[s.ECONNREFUSED]:"Connection refused",[s.EHOSTDOWN]:"Host is down",[s.EHOSTUNREACH]:"No route to host",[s.EALREADY]:"Operation already in progress",[s.EINPROGRESS]:"Operation now in progress",[s.ESTALE]:"Stale file handle",[s.EREMOTEIO]:"Remote I/O error",[s.EDQUOT]:"Disk quota exceeded"},E=class extends Error{static fromJSON(t){let i=new E(t.errno,t.message,t.path,t.syscall);return i.code=t.code,i.stack=t.stack,i}static With(t,i,n){return new E(s[t],L[s[t]],i,n)}constructor(t,i=L[t],n,r=""){super(i),this.errno=t,this.path=n,this.syscall=r,this.code=s[t],this.message=`${this.code}: ${i}${this.path?`, '${this.path}'`:""}`}toString(){return this.message}toJSON(){return{errno:this.errno,code:this.code,path:this.path,stack:this.stack,message:this.message,syscall:this.syscall}}bufferSize(){return 4+JSON.stringify(this.toJSON()).length}};c(E,"ErrnoError");var P=class{constructor(t){this.store=t,this.aborted=!1}async[Symbol.asyncDispose](){this.aborted||await this.commit()}[Symbol.dispose](){this.aborted||this.commitSync()}};c(P,"Transaction");var p=class extends P{getSync(){throw E.With("ENOSYS",void 0,"AsyncTransaction.getSync")}setSync(){throw E.With("ENOSYS",void 0,"AsyncTransaction.setSync")}removeSync(){throw E.With("ENOSYS",void 0,"AsyncTransaction.removeSync")}commitSync(){throw E.With("ENOSYS",void 0,"AsyncTransaction.commitSync")}abortSync(){throw E.With("ENOSYS",void 0,"AsyncTransaction.abortSync")}};c(p,"AsyncTransaction");function m(e){return new Promise((t,i)=>{e.onsuccess=()=>t(e.result),e.onerror=n=>{n.preventDefault(),i(u(e.error))}})}c(m,"wrap");var N=class extends p{constructor(i,n){super(n);this.tx=i;this.store=n;this._idb=i.objectStore(n.name)}_idb;get(i){return m(this._idb.get(i.toString()))}async set(i,n){await m(this._idb.put(n,i.toString()))}remove(i){return m(this._idb.delete(i.toString()))}async commit(){this.tx.commit()}async abort(){try{this.tx.abort()}catch(i){throw u(i)}}};c(N,"IndexedDBTransaction");async function q(e,t=globalThis.indexedDB){let i=t.open(e);return i.onupgradeneeded=()=>{let r=i.result;r.objectStoreNames.contains(e)&&r.deleteObjectStore(e),r.createObjectStore(e)},await m(i)}c(q,"createDB");var g=class{constructor(t){this.db=t}sync(){throw new Error("Method not implemented.")}get name(){return this.db.name}clear(){return m(this.db.transaction(this.name,"readwrite").objectStore(this.name).clear())}clearSync(){throw l.With("ENOSYS",void 0,"IndexedDBStore.clearSync")}transaction(){let t=this.db.transaction(this.name,"readwrite");return new N(t,this)}};c(g,"IndexedDBStore");var Q={name:"IndexedDB",options:{storeName:{type:"string",required:!1,description:"The name of this file system. You can have multiple IndexedDB file systems operating at once, but each must have a different name."},idbFactory:{type:"object",required:!1,description:"The IDBFactory to use. Defaults to globalThis.indexedDB."}},async isAvailable(e=globalThis.indexedDB){try{if(!(e instanceof IDBFactory))return!1;let t=e.open("__zenfs_test");return await m(t),e.deleteDatabase("__zenfs_test"),!0}catch{return e.deleteDatabase("__zenfs_test"),!1}},async create(e){let t=await q(e.storeName||"zenfs",e.idbFactory),i=new g(t),n=new(I(R))(i);return e?.disableAsyncCache||(n._sync=F.create({name:"idb-cache"})),n}};var T=class{constructor(t){this._storage=t}get name(){return H.name}clear(){this._storage.clear()}clearSync(){this._storage.clear()}async sync(){}transaction(){return new k(this)}get(t){let i=this._storage.getItem(t.toString());if(typeof i=="string")return C(i)}set(t,i){try{this._storage.setItem(t.toString(),B(i))}catch{throw new l(S.ENOSPC,"Storage is full.")}}delete(t){try{this._storage.removeItem(t.toString())}catch(i){throw new l(S.EIO,"Unable to delete key "+t+": "+i)}}};c(T,"WebStorageStore");var H={name:"WebStorage",options:{storage:{type:"object",required:!1,description:"The Storage to use. Defaults to globalThis.localStorage."}},isAvailable(e=globalThis.localStorage){return e instanceof globalThis.Storage},create({storage:e=globalThis.localStorage}){return new R(new T(e))}};return G(j);})();
//# sourceMappingURL=zenfs-dom-browser.min.js.map
